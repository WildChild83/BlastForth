( ---------------------------------------------------------------------------- )
( **************************************************************************** )
(       PNG File Loader                                                        )
( **************************************************************************** )
( ---------------------------------------------------------------------------- )

( ---------------------------------------------------------------------------- )
(                                                                              )
(       Large portions of this file were ported to Forth                       )
(       from Lode Vandevenne's excellent LODEPNG loader:                       )
(                                                                              )
(           lodev.org/lodepng/                                                 )
(                                                                              )
( ---------------------------------------------------------------------------- )

( ---------------------------------------------------------------------------- )
(                                                                              )
(       Dependencies:                                                          )
(           - glossary.fs                                                      )
(           - import.fs                                                        )
(                                                                              )
( ---------------------------------------------------------------------------- )
Importing definitions {

( ---------------------------------------------------------------------------- )
(       State Variables                                                        )
( ---------------------------------------------------------------------------- )

( ---------------------------------------------------------------------------- )
(       Utilities                                                              )
( ---------------------------------------------------------------------------- )


( ---------------------------------------------------------------------------- )
(       zLib                                                                   )
( ---------------------------------------------------------------------------- )
0   field: br.data
    field: br.size
    field: br.bitsize
    field: br.bp
    field: br.buffer
constant bitreader

: br.init ( data size bitreader -- )
    0 over br.bp !   0 over br.buffer !
    over 3 lshift over br.bitsize !   tuck br.size ! br.data ! ;

: br.ensure9bits ( bitreader -- )
    dup br.bp @ 3 rshift over br.size @ over 1+ >
    if   over br.data @ + count swap c@ or 8 lshift 
    else over br.size @ < if dup br.data @ else 0 endif endif
    over br.bp @ 7 and rshift swap br.buffer ! ;

( ---------------------------------------------------------------------------- )
(       Deflate                                                                )
( ---------------------------------------------------------------------------- )

( ---------------------------------------------------------------------------- )
(       Huffman                                                                )
( ---------------------------------------------------------------------------- )

( ---------------------------------------------------------------------------- )
( ---------------------------------------------------------------------------- )
( ---------------------------------------------------------------------------- )
( ---------------------------------------------------------------------------- )
( ---------------------------------------------------------------------------- )
( ---------------------------------------------------------------------------- )
( ---------------------------------------------------------------------------- )
( ---------------------------------------------------------------------------- )
( ---------------------------------------------------------------------------- )














